ScreenManager:
    LoginScreen:
    MainScreen:
    AddProductScreen:
    DeleteProductScreen:
    ChartScreen:

<LoginScreen>:
    name: "login"
    MDFloatLayout:
        MDLabel:
            text: "Login"
            halign: "center"
            pos_hint: {"center_y": 0.85}
            font_style: "H4"

        MDTextField:
            id: username
            hint_text: "Username"
            pos_hint: {"center_x": 0.5, "center_y": 0.65}
            size_hint_x: 0.8

        MDTextField:
            id: password
            hint_text: "Password"
            password: True
            pos_hint: {"center_x": 0.5, "center_y": 0.55}
            size_hint_x: 0.8

        MDRaisedButton:
            text: "Login"
            pos_hint: {"center_x": 0.5, "center_y": 0.45}
            on_press: root.login()

        MDLabel:
            id: login_message
            text: ""
            halign: "center"
            pos_hint: {"center_y": 0.35}
            theme_text_color: "Error"

<MainScreen>:
    name: "main"

    MDBottomNavigation:
        id: bottom_nav

        MDBottomNavigationItem:
            name: 'inventory'
            text: 'Inventory'
            icon: 'package-variant'

            BoxLayout:
                orientation: 'vertical'
                padding: dp(10)
                spacing: dp(10)

                MDLabel:
                    text: "Product Inventory"
                    halign: "center"
                    font_style: "H6"
                    size_hint_y: None
                    height: dp(40)

                ScrollView:
                    MDList:
                        id: inventory_list

        MDBottomNavigationItem:
            name: 'manage'
            text: 'Manage Products'
            icon: 'cog-outline'

            BoxLayout:
                orientation: 'vertical'
                spacing: dp(15)
                padding: dp(20)

                Widget:

                MDLabel:
                    text: "Select Product Action"
                    halign: "center"
                    font_style: "H6"
                    size_hint_y: None
                    height: dp(40)

                MDRaisedButton:
                    text: "Add Product"
                    icon: "plus-box"
                    pos_hint: {"center_x": 0.5}
                    on_release: app.root.current = 'add_product'

                MDRaisedButton:
                    text: "Delete Product"
                    icon: "delete"
                    pos_hint: {"center_x": 0.5}
                    on_release: app.root.current = 'delete_product'

                Widget:

        MDBottomNavigationItem:
            name: 'transactions'
            text: 'Transactions'
            icon: 'cash-multiple'

            MDBoxLayout:
                orientation: 'vertical'
                padding: dp(20)
                spacing: dp(20)

                MDLabel:
                    text: "Record a Transaction"
                    halign: "center"
                    font_style: "H6"
                    size_hint_y: None
                    height: dp(40)

                MDSpinner:
                    id: transaction_spinner
                    active: True
                    size_hint: None, None
                    size: dp(40), dp(40)
                    pos_hint: {"center_x": 0.5}
                    opacity: 0  # Initially hidden, only visible if loading

                MDTextField:
                    id: transaction_type_field
                    hint_text: "Select Transaction Type"
                    readonly: True
                    on_focus: if self.focus: app.open_transaction_type_menu()
                    pos_hint: {"center_x": 0.5}
                    size_hint_x: 0.9

                MDTextField:
                    id: product_field
                    hint_text: "Search Product"
                    pos_hint: {"center_x": 0.5}
                    size_hint_x: 0.9
                    on_text: app.update_product_suggestions(self.text)

                MDTextField:
                    id: transaction_qty
                    hint_text: "Enter Quantity"
                    input_filter: "int"
                    pos_hint: {"center_x": 0.5}
                    size_hint_x: 0.9

                MDLabel:
                    id: transaction_error
                    text: ""
                    theme_text_color: "Error"
                    halign: "center"

                MDRaisedButton:
                    text: "Submit Transaction"
                    pos_hint: {"center_x": 0.5}
                    on_release: root.submit_transaction()

        MDBottomNavigationItem:
            name: 'history'
            text: 'History'
            icon: 'history'

            MDBoxLayout:
                orientation: 'vertical'
                padding: dp(20)
                spacing: dp(10)

                MDBoxLayout:
                    size_hint_y: None
                    height: dp(30)

                    MDLabel:
                        text: "Transaction Logs"
                        font_style: "H6"
                        halign: "left"

                    MDIconButton:
                        icon: "chart-bar"
                        pos_hint: {"center_y": 0.5}
                        on_release: app.go_to_chart_screen()

                MDBoxLayout:
                    size_hint_y: None
                    height: dp(40)
                    spacing: dp(10)

                    MDTextField:
                        id: history_search
                        hint_text: "Search by product"
                        on_text: app.filter_logs()

                    MDDropDownItem:
                        id: history_filter_type
                        text: "All"
                        on_release: app.open_history_filter_menu()

                ScrollView:
                    MDList:
                        id: history_list

                # Chart display area (initially empty)
                BoxLayout:
                    id: transaction_chart_box
                    size_hint_y: None
                    height: dp(200)

        MDBottomNavigationItem:
            name: 'employees'
            text: 'Employees'
            icon: 'account-group-outline'

            MDBoxLayout:
                orientation: 'vertical'
                padding: dp(20)
                spacing: dp(20)

                MDLabel:
                    text: "Employee Section (Coming Soon)"
                    halign: "center"
                    font_style: "H6"

<AddProductScreen>:
    name: "add_product"
    MDBoxLayout:
        orientation: 'vertical'

        MDTopAppBar:
            title: "Add Product"
            left_action_items: [["arrow-left", lambda x: (app.reset_add_product_screen(), setattr(app.root, "current", "main"))]]

        Widget:

        MDTextField:
            id: name_field
            hint_text: "Product Name"
        MDLabel:
            id: name_warn
            text: ""
            theme_text_color: "Error"
            font_style: "Caption"

        MDTextField:
            id: qty_field
            hint_text: "Quantity"
            input_filter: "int"
        MDLabel:
            id: qty_warn
            text: ""
            theme_text_color: "Error"
            font_style: "Caption"

        MDTextField:
            id: price_field
            hint_text: "Price"
            input_filter: "float"
        MDLabel:
            id: price_warn
            text: ""
            theme_text_color: "Error"
            font_style: "Caption"

        MDTextField:
            id: exp_field
            hint_text: "Expiration Date (YYYY-MM-DD)"
        MDLabel:
            id: exp_warn
            text: ""
            theme_text_color: "Error"
            font_style: "Caption"

        MDRaisedButton:
            text: "Submit"
            pos_hint: {"center_x": 0.5}
            on_release: app.submit_product()

        Widget:

<DeleteProductScreen>:
    name: "delete_product"
    MDBoxLayout:
        orientation: 'vertical'

        MDTopAppBar:
            title: "Delete Product"
            left_action_items: [["arrow-left", lambda x: (app.reset_delete_product_screen(), setattr(app.root, "current", "main"))]]

        Widget:

        MDTextField:
            id: delete_field
            hint_text: "Enter product name to delete"

        MDLabel:
            id: delete_warn
            text: ""
            theme_text_color: "Error"
            font_style: "Caption"

        MDRaisedButton:
            text: "Delete"
            pos_hint: {"center_x": 0.5}
            on_release: app.delete_product_from_manage()

        Widget:

<ChartScreen>:
    name: "chart_screen"

    BoxLayout:
        orientation: "vertical"

        MDTopAppBar:
            title: "Sales Chart"
            left_action_items: [["arrow-left", lambda x: app.back_to_main()]]

        MDBoxLayout:
            size_hint_y: None
            height: dp(50)
            spacing: dp(10)
            padding: dp(10)

            MDDropDownItem:
                id: chart_type_dropdown
                text: "line"
                on_release: app.open_chart_type_menu()

            MDDropDownItem:
                id: range_dropdown
                text: "daily"
                on_release: app.open_range_menu()

            MDDropDownItem:
                id: product_dropdown
                text: "All"
                on_release: app.open_product_menu()

        ScrollView:
            BoxLayout:
                id: chart_container
                orientation: "vertical"
                size_hint_y: None
                height: self.minimum_height

